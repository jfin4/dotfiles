#!/usr/bin/env python

from datetime import datetime, timedelta
from subprocess import run
import sys
import time

# astronomical dawn
dawn_times = [
    "0540", "0540", "0541", "0541", "0541", "0541", "0541", "0541", "0541",
    "0541", "0541", "0541", "0541", "0541", "0541", "0541", "0541", "0540",
    "0540", "0540", "0540", "0539", "0539", "0538", "0538", "0538", "0537",
    "0537", "0536", "0535", "0535", "0534", "0534", "0533", "0532", "0531",
    "0531", "0530", "0529", "0528", "0527", "0527", "0526", "0525", "0524",
    "0523", "0522", "0521", "0520", "0519", "0518", "0517", "0515", "0514",
    "0513", "0512", "0511", "0509", "0508", "0507", "0506", "0504", "0503",
    "0502", "0500", "0459", "0458", "0456", "0455", "0454", "0452", "0451",
    "0449", "0448", "0446", "0445", "0443", "0442", "0440", "0439", "0437",
    "0436", "0434", "0433", "0431", "0430", "0428", "0427", "0425", "0423",
    "0422", "0420", "0419", "0417", "0416", "0414", "0412", "0411", "0409",
    "0408", "0406", "0405", "0403", "0401", "0400", "0358", "0357", "0355",
    "0354", "0352", "0351", "0349", "0348", "0346", "0345", "0343", "0342",
    "0340", "0339", "0337", "0336", "0335", "0333", "0332", "0331", "0329",
    "0328", "0327", "0325", "0324", "0323", "0322", "0321", "0319", "0318",
    "0317", "0316", "0315", "0314", "0313", "0312", "0311", "0310", "0309",
    "0308", "0308", "0307", "0306", "0305", "0305", "0304", "0304", "0303",
    "0302", "0302", "0302", "0301", "0301", "0300", "0300", "0300", "0300",
    "0300", "0259", "0259", "0259", "0259", "0259", "0300", "0300", "0300",
    "0300", "0300", "0301", "0301", "0301", "0302", "0302", "0303", "0303",
    "0304", "0304", "0305", "0305", "0306", "0307", "0308", "0308", "0309",
    "0310", "0311", "0312", "0313", "0313", "0314", "0315", "0316", "0317",
    "0318", "0319", "0320", "0321", "0322", "0324", "0325", "0326", "0327",
    "0328", "0329", "0330", "0331", "0332", "0333", "0335", "0336", "0337",
    "0338", "0339", "0340", "0341", "0342", "0344", "0345", "0346", "0347",
    "0348", "0349", "0350", "0351", "0352", "0353", "0354", "0355", "0356",
    "0358", "0359", "0400", "0401", "0402", "0403", "0404", "0405", "0406",
    "0407", "0408", "0408", "0409", "0410", "0411", "0412", "0413", "0414",
    "0415", "0416", "0417", "0418", "0419", "0419", "0420", "0421", "0422",
    "0423", "0424", "0425", "0425", "0426", "0427", "0428", "0429", "0430",
    "0430", "0431", "0432", "0433", "0434", "0434", "0435", "0436", "0437",
    "0438", "0439", "0439", "0440", "0441", "0442", "0443", "0443", "0444",
    "0445", "0446", "0447", "0447", "0448", "0449", "0450", "0451", "0451",
    "0452", "0453", "0454", "0455", "0455", "0456", "0457", "0458", "0459",
    "0500", "0500", "0501", "0502", "0503", "0504", "0505", "0506", "0506",
    "0507", "0508", "0509", "0510", "0511", "0511", "0512", "0513", "0514",
    "0515", "0516", "0516", "0517", "0518", "0519", "0520", "0520", "0521",
    "0522", "0523", "0524", "0524", "0525", "0526", "0527", "0527", "0528",
    "0529", "0529", "0530", "0531", "0531", "0532", "0533", "0533", "0534",
    "0534", "0535", "0536", "0536", "0537", "0537", "0537", "0538", "0538",
    "0539", "0539", "0539", "0540", "0540",
]


tomorrow = datetime.today() + timedelta(days=1)
tomorrow = tomorrow.strftime('%Y%m%d')
day_no = int(datetime.today().strftime('%j'))
dawn_time = dawn_times[day_no]

if time.localtime().tm_isdst:
    dawn_time = int(dawn_time)
    dawn_time = dawn_time + 100
    dawn_time = str(dawn_time).zfill(4)

if len(sys.argv) > 1: 
    print("sudo",
        "rtcwake",
        "--date",
        tomorrow + dawn_time + '00',
        "-m",
        "mem")
    sys.exit()

run([
    "sudo",
    "rtcwake",
    "--date",
    tomorrow + dawn_time + '00',
    "-m",
    "mem",
])
run([
    "pamixer",
    "--set-volume",
    "80",
])
run([
    "mpv",
    "--no-resume-playback",
    "/home/jfin/music/beethoven/quartetto-italiano/late-quartets/op-127-2.mp3"
])

# https://www.timeanddate.com/sun/usa/san-luis-obispo
# vim:set foldmethod=indent:"

# Options
auto_view text/html # view html emails in pager
# alternative_order text/plain text/html # view text first if available
attachments +A */.* 
attachments -A */ics

color hdrdefault brightblack default
color index      blue        default ~U  # unread messages
color index      green       default ~Q  # replied messages
color index      red         default ~D  # deleted messages
color indicator  black       white       # indicator bar
color quoted     brightblack default
color status     brightblack default       # status bar

folder-hook ~/mail/johninman 'source ~/.mutt/johninman' 
folder-hook ~/mail/icloud 'source ~/.mutt/icloud' 
folder-hook ~/mail/gmail 'source ~/.mutt/gmail' 
folder-hook ~/mail/csumb 'source ~/.mutt/csumb' 

save-hook . /home/jfin/mail/saved

set my_year=`date +%Y`

set sleep_time=0
set mailcap_path = ~/.mutt/mailcap
set abort_noattach=ask-yes # ask if no attachments
# set abort_noattach_regex='\\<attach(ed|ments?)\\>'
set abort_nosubject=no # abort messages with no subject?
set abort_unmodified=no # just do it
set alias_file='~/.mutt/aliases' # where I keep my aliases
set confirmcreate=no # just create the mailbox
set confirmappend=no # just append saved messages
set delete=yes # purge deleted messages without asking
set edit_headers=yes # let me edit the message header when composing
set editor='vim +"set tw=0" +"set spell"' # editor settings
set fast_reply=yes # skip initial prompts when replying
set fcc_attach=no # keep attachments in copies of sent messages?
set header_cache=~/.cache/mutt # where to keep headers cache
set help=no
set hostname=foo
set include=yes # always include messages when replying
# month, day, from, to, cc, attachments, subject
set index_format='%[%a %m/%d %H:%M]  %-15.15F %?X? @&  ? %s'
set recall=no # prompt to recall postponed messages?
set realname='John Inman' # my real name
set sort=reverse-threads # primary sorting method
set sort_aux=last-date-received # old thread w new child on top
set to_chars=' !    '
set trash='~/.mail/trash'
set use_envelope_from=yes # populate envelope-from from From: header
set use_from=yes # use from address
set wait_key=no # don't have to press key after external command

ignore * # ignore all headers
unignore from date subject to cc bcc # don't ignore these headers

source ~/.mutt/johninman # source personal account
source ~/.mutt/aliases # source alias file

bind browser G last-entry
bind browser g first-entry
# bind browser h goto-parent
bind browser l select-entry

macro compose a '<attach-file>?'

bind index G last-entry
bind index N search-opposite
bind index P recall-message
bind index R group-reply
bind index g first-entry
bind index l display-message
bind index y sync-mailbox
macro index 1 '<change-folder>~/mail/johninman/INBOX<enter>'
macro index 2 "<change-folder>~/mail/johninman/Archive/$my_year<enter>"
macro index 3 '<change-folder>~/mail/johninman/Sent<enter>'
macro index 4 '<change-folder>~/mail/johninman/Drafts<enter>'
macro index 5 '<change-folder>~/mail/johninman/Trash<enter>'
macro index h '<change-folder>?' 'show incoming mailboxes list'
# macro index I '<shell-escape>mbsync -a<enter>' 'sync all accounts'

bind attach <return> view-mailcap

bind pager G bottom
bind pager L group-reply
bind pager R group-reply
bind pager g top 
bind pager h exit
bind pager j next-line
bind pager k previous-line
bind pager l reply

macro index <F8> \
"<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
<shell-escape>notmuch-mutt -r --prompt search<enter>\
<change-folder-readonly>`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`<enter>\
<enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
    "notmuch: search mail"

macro index <F9> \
"<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
<pipe-message>notmuch-mutt -r thread<enter>\
<change-folder-readonly>`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`<enter>\
<enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
    "notmuch: reconstruct thread"

macro index <F6> \
"<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
<pipe-message>notmuch-mutt tag -- -inbox<enter>\
<enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
    "notmuch: remove message from inbox"

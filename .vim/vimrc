" first thing's first
syntax on
filetype indent on
filetype plugin on
colorscheme jfin

" define variables
let mapleader = ' '
let maplocalleader = ' '

" other options
set autoread 
set autowriteall
set background=dark
set belloff=all
set completeopt=menuone,longest
set encoding=utf-8
set fillchars-=vert:\\|
set formatoptions=qlcjnr
set hlsearch
set ignorecase 
set laststatus=2
set mouse=
set pastetoggle=<insert> 
set scrolloff=5
set shell=bash
" set shortmess-=S
set ruler
set signcolumn=no
set smartcase 
set t_Co=16
set undofile 
set virtualedit=block
set wildmenu
set wildmode=full

" dir options
set backupdir=~/.vim/backup
set directory=~/.vim/swap
set undodir=~/.vim/undo 
set viewdir=~/.vim/view
set viminfo+=n~/.vim/.viminfo

" maps
nnoremap <cr> :write<cr>
nnoremap <silent> <esc> :noh<cr>
tnoremap <esc><esc> <c-\><c-n>
tnoremap :: <c-w>:
nnoremap <leader>n /=expand('<cword>')<cr><cr>

" indentation
set autoindent 
set breakindent 
set breakindentopt=shift:0
set expandtab 
set linebreak 
set shiftround 
set shiftwidth=4
set showbreak=+++\ 
set tabstop=4
set textwidth=78 

" folds
set foldlevelstart=0
set foldmethod=marker

" snippets
let g:snipMate = get(g:, 'snipMate', {
            \ 'always_choose_first' : 1,
            \ 'no_match_completion_feedkeys_chars' : '',
            \ })
inoremap <c-l> <Plug>snipMateNextOrTrigger
snoremap <c-l> <Plug>snipMateNextOrTrigger
inoremap <c-h> <Plug>snipMateBack
snoremap <c-h> <Plug>snipMateBack
augroup snipmate
   au!
   autocmd bufleave *.snippets SnipMateLoadScope %
augroup end

" completion
let g:mucomplete#no_mappings = 1
let g:mucomplete#chains = {
    \ 'default' : ['path', 'omni', 'keyp', 'dict', 'uspl'],
    \ 'r' : ['path', 'omni', 'keyn', 'dict', 'uspl']
    \ }

imap <tab> <plug>(MUcompleteFwd)
imap <s-tab> <plug>(MUcompleteBwd)
imap <c-space> <plug>(MUcompleteCycFwd)
imap <expr> . mucomplete#extend_bwd(".")

" get highlight group
function! GetHighlight()
    let hi    = synIDattr(synID(line('.'), col('.'), 1), 'name')
    let trans = synIDattr(synID(line('.'), col('.'), 0), 'name')
    let lo    = synIDattr(synIDtrans(synID(line('.'), col('.'), 1)), 'name')
    echo 'hi:' . hi . ', trans:' . trans . ', lo:' . lo
endfunction

" source updated config files 
augroup vimrc
    au!
    autocmd BufWritePost vimrc source <afile>
    autocmd BufWritePost */plugin/*.vim  source <afile>
    autocmd BufWritePost */colors/*.vim  source <afile>
augroup end

" fzf
let g:fzf_colors = { 'border':  ['fg', 'vertsplit'] }

"lsp
let g:lsp_use_native_client = 1
let g:lsp_semantic_enabled = 0
let g:lsp_format_sync_timeout = 1000
let g:lsp_diagnostics_enabled = 0
let g:lsp_settings_enable_suggestions = 0
let g:lsp_completion_documentation_enabled = 0
let g:lsp_signature_help_enabled = 0
set omnifunc=lsp#complete
inoremap <nul> <c-o><plug>(lsp-signature-help)

" sideways
nnoremap <leader>ah :SidewaysLeft<cr>
nnoremap <leader>al :SidewaysRight<cr>

" utilities

function! Win2Unix()
    execute 's/\\/\//g'
    execute 's/[cC]:\//\/c\/'
endfunction
command! Win2Unix silent! call Win2Unix()

function! Start()
    let link = getline(line('.'))->substitute('^"\|"$', '', 'g')
    if fnamemodify(link, ':e') == 'pdf'
        execute printf('call system(''SumatraPDF-3.5.2-64.exe "%s"'')',
                    \ link)
    else
        execute printf('call system(''start "" "%s"'')',
                    \ link)
    endif
endfunction
command! Start call Start()

" markdown
let g:vim_markdown_conceal = 2
let g:vim_markdown_folding_disabled = 1
let g:vim_markdown_new_list_item_indent = 0
set conceallevel=2

" notes
cabbrev todo BLines #todo<cr>
